<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0"
    />
    <title>Contest Management Platform</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
        background: white;
        border-radius: 10px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        overflow: hidden;
      }

      .header {
        background: linear-gradient(135deg, #2c3e50, #34495e);
        color: white;
        padding: 20px;
        text-align: center;
      }

      .header h1 {
        margin-bottom: 10px;
      }

      .user-info {
        background: #34495e;
        padding: 15px;
        border-radius: 4px;
        margin-top: 15px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .role-badge {
        padding: 4px 12px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: bold;
        text-transform: uppercase;
      }

      .role-host {
        background: #9b59b6;
        color: white;
      }
      .role-judge {
        background: #e67e22;
        color: white;
      }
      .role-team {
        background: #3498db;
        color: white;
      }

      .nav {
        background: #34495e;
        padding: 0;
        display: flex;
        justify-content: center;
        flex-wrap: wrap;
      }

      .nav button {
        background: #34495e;
        color: white;
        border: none;
        padding: 15px 25px;
        cursor: pointer;
        font-size: 14px;
        transition: background 0.3s;
      }

      .nav button:hover,
      .nav button.active {
        background: #2c3e50;
      }

      .content {
        padding: 30px;
        min-height: 500px;
      }

      .section {
        display: none;
      }

      .section.active {
        display: block;
      }

      .login-container {
        max-width: 400px;
        margin: 100px auto;
        background: white;
        padding: 40px;
        border-radius: 10px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      }

      .form-group {
        margin-bottom: 15px;
      }

      .form-group label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
        color: #2c3e50;
      }

      .form-group input,
      .form-group select,
      .form-group textarea {
        width: 100%;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 14px;
      }

      .btn {
        background: #3498db;
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 14px;
        transition: background 0.3s;
        margin-right: 10px;
      }

      .btn:hover {
        background: #2980b9;
      }
      .btn-success {
        background: #27ae60;
      }
      .btn-success:hover {
        background: #229954;
      }
      .btn-danger {
        background: #e74c3c;
      }
      .btn-danger:hover {
        background: #c0392b;
      }
      .btn-warning {
        background: #f39c12;
      }
      .btn-warning:hover {
        background: #e67e22;
      }

      .card {
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 20px;
        background: white;
      }

      .hidden {
        display: none !important;
      }

      .status-badge {
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 12px;
        font-weight: bold;
        text-transform: uppercase;
      }

      .status-submitted {
        background: #3498db;
        color: white;
      }
      .status-evaluating {
        background: #f39c12;
        color: white;
      }
      .status-evaluated {
        background: #27ae60;
        color: white;
      }
      .status-failed {
        background: #e74c3c;
        color: white;
      }

      .submission-card {
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 15px;
        background: white;
      }

      .submission-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
      }

      .alert {
        padding: 15px;
        border-radius: 4px;
        margin-bottom: 15px;
      }

      .alert-success {
        background: #d4edda;
        border: 1px solid #c3e6cb;
        color: #155724;
      }
      .alert-warning {
        background: #fff3cd;
        border: 1px solid #ffeaa7;
        color: #856404;
      }
      .alert-error {
        background: #f8d7da;
        border: 1px solid #f5c6cb;
        color: #721c24;
      }

      .grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
      }

      .file-browser {
        border: 1px solid #ddd;
        border-radius: 4px;
        max-height: 400px;
        overflow-y: auto;
      }

      .file-item {
        padding: 8px 12px;
        border-bottom: 1px solid #eee;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .file-item:hover {
        background: #f8f9fa;
      }

      .file-content {
        background: #f8f9fa;
        border: 1px solid #ddd;
        border-radius: 4px;
        padding: 15px;
        font-family: monospace;
        white-space: pre-wrap;
        max-height: 400px;
        overflow-y: auto;
        margin-top: 10px;
      }

      .score-input {
        width: 80px;
        text-align: center;
      }

      .confirmation-dialog {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1000;
      }

      .dialog-content {
        background: white;
        padding: 30px;
        border-radius: 8px;
        max-width: 500px;
        width: 90%;
      }

      .table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 15px;
      }

      .table th,
      .table td {
        padding: 12px;
        text-align: left;
        border-bottom: 1px solid #ddd;
      }

      .table th {
        background: #f8f9fa;
        font-weight: bold;
      }

      .table tr:hover {
        background: #f8f9fa;
      }

      .rubric-container {
        margin: 20px 0;
      }

      .rubric-section {
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 20px;
        background: #fdfdfd;
      }

      .rubric-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
      }

      .weight-indicator {
        background: #3498db;
        color: white;
        padding: 4px 8px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: bold;
      }

      .rubric-description {
        color: #666;
        margin-bottom: 15px;
        font-style: italic;
      }

      .scoring-levels {
        margin: 15px 0;
      }

      .scoring-level {
        margin-bottom: 10px;
      }

      .scoring-level label {
        display: flex;
        align-items: flex-start;
        cursor: pointer;
        padding: 10px;
        border: 1px solid #eee;
        border-radius: 4px;
        transition: all 0.2s;
      }

      .scoring-level label:hover {
        background: #f8f9fa;
        border-color: #3498db;
      }

      .scoring-level input[type="radio"] {
        margin-right: 10px;
        margin-top: 4px;
      }

      .level-content {
        flex: 1;
      }

      .level-content strong {
        color: #2c3e50;
        display: block;
        margin-bottom: 4px;
      }

      .custom-score {
        margin-top: 10px;
        padding: 10px;
        background: #f8f9fa;
        border-radius: 4px;
      }

      .custom-score-input {
        width: 80px;
        margin-left: 10px;
        padding: 4px 8px;
        border: 1px solid #ddd;
        border-radius: 4px;
      }

      .score-summary {
        background: #e8f5e8;
        border: 1px solid #4caf50;
        border-radius: 8px;
        padding: 15px;
        margin: 20px 0;
        text-align: center;
      }

      .score-excellent {
        color: #27ae60;
      }
      .score-good {
        color: #f39c12;
      }
      .score-fair {
        color: #e67e22;
      }
      .score-poor {
        color: #e74c3c;
      }

      .form-actions {
        display: flex;
        gap: 10px;
        justify-content: flex-end;
        margin-top: 20px;
        padding-top: 20px;
        border-top: 1px solid #eee;
      }

      .submission-info {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 4px;
        margin-bottom: 20px;
      }

      .metrics-section {
        margin: 15px 0;
        border: 1px solid #ddd;
        border-radius: 4px;
      }

      .metrics-section summary {
        padding: 10px 15px;
        background: #f8f9fa;
        cursor: pointer;
        font-weight: bold;
      }

      .metrics-display {
        padding: 15px;
        max-height: 300px;
        overflow-y: auto;
      }

      .file-actions {
        margin: 10px 0;
        display: flex;
        gap: 10px;
      }

      .file-content {
        background: #f8f9fa;
        border: 1px solid #ddd;
        border-radius: 4px;
        padding: 15px;
        font-family: "Courier New", monospace;
        white-space: pre-wrap;
        max-height: 500px;
        overflow-y: auto;
        margin-top: 10px;
        line-height: 1.4;
      }

      .auto-refresh-controls {
        position: fixed;
        bottom: 20px;
        right: 20px;
        z-index: 100;
      }

      .notification-badge {
        position: absolute;
        top: -5px;
        right: -5px;
        background: #e74c3c;
        color: white;
        border-radius: 50%;
        padding: 2px 6px;
        font-size: 10px;
        font-weight: bold;
      }

      .status-indicator {
        display: inline-block;
        width: 8px;
        height: 8px;
        border-radius: 50%;
        margin-right: 8px;
      }

      .status-indicator.online {
        background: #27ae60;
      }
      .status-indicator.offline {
        background: #e74c3c;
      }
      .status-indicator.pending {
        background: #f39c12;
      }

      .problem-selection {
        display: grid;
        gap: 20px;
        margin-top: 20px;
      }

      .problem-card {
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 20px;
        background: white;
        transition: all 0.3s;
      }

      .problem-card:hover {
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        border-color: #3498db;
      }

      .problem-card.has-submission {
        border-left: 4px solid #3498db;
      }

      .problem-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
      }

      .problem-status {
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .problem-description {
        color: #666;
        margin-bottom: 15px;
        line-height: 1.5;
      }

      .existing-submission {
        background: #f8f9fa;
        border-radius: 4px;
        padding: 15px;
        margin: 15px 0;
        border-left: 3px solid #3498db;
      }

      .existing-submission h5 {
        margin-bottom: 10px;
        color: #2c3e50;
      }

      .submission-actions {
        display: flex;
        gap: 10px;
        margin-top: 15px;
      }

      .submission-form {
        margin-top: 20px;
        border-left: 4px solid #27ae60;
      }

      .submission-requirements {
        background: #f8f9fa;
        border-radius: 4px;
        padding: 15px;
        margin: 15px 0;
      }

      .submission-requirements h4 {
        color: #2c3e50;
        margin-bottom: 10px;
      }

      .submission-requirements ul {
        margin-left: 20px;
        color: #666;
      }

      .submission-requirements li {
        margin-bottom: 5px;
      }

      .submission-details {
        margin-top: 20px;
        border-left: 4px solid #3498db;
      }

      .detail-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 15px;
        margin: 20px 0;
      }

      .detail-item {
        padding: 10px;
        background: #f8f9fa;
        border-radius: 4px;
      }

      .detail-item strong {
        display: block;
        color: #2c3e50;
        margin-bottom: 5px;
      }

      .evaluation-progress {
        margin-top: 10px;
      }

      .progress-bar {
        width: 100%;
        height: 8px;
        background: #ecf0f1;
        border-radius: 4px;
        overflow: hidden;
        margin-bottom: 8px;
      }

      .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #3498db, #2ecc71);
        width: 40%;
        animation: progress-pulse 2s ease-in-out infinite;
      }

      @keyframes progress-pulse {
        0%,
        100% {
          width: 40%;
        }
        50% {
          width: 70%;
        }
      }

      .status-text {
        color: #666;
        font-size: 14px;
      }

      .loading-spinner {
        display: inline-block;
        width: 14px;
        height: 14px;
        border: 2px solid #f3f3f3;
        border-top: 2px solid #3498db;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin-right: 8px;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .submission-progress {
        margin-top: 20px;
        padding: 20px;
        background: #f8f9fa;
        border-radius: 8px;
        border-left: 4px solid #3498db;
      }

      .progress-steps {
        display: flex;
        justify-content: space-between;
        margin-bottom: 20px;
        position: relative;
      }

      .progress-steps::before {
        content: "";
        position: absolute;
        top: 15px;
        left: 15px;
        right: 15px;
        height: 2px;
        background: #ddd;
        z-index: 1;
      }

      .step {
        display: flex;
        flex-direction: column;
        align-items: center;
        position: relative;
        z-index: 2;
      }

      .step-number {
        width: 30px;
        height: 30px;
        border-radius: 50%;
        background: #ddd;
        color: #666;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        font-size: 14px;
        margin-bottom: 8px;
        transition: all 0.3s;
      }

      .step.active .step-number {
        background: #3498db;
        color: white;
      }

      .step-label {
        font-size: 12px;
        text-align: center;
        color: #666;
        max-width: 100px;
      }

      .step.active .step-label {
        color: #2c3e50;
        font-weight: bold;
      }

      .progress-message {
        text-align: center;
        color: #2c3e50;
        font-weight: 500;
        padding: 10px;
        background: white;
        border-radius: 4px;
        border: 1px solid #ddd;
      }

      .submission-status-update {
        position: fixed;
        top: 20px;
        right: 20px;
        max-width: 400px;
        z-index: 1000;
        animation: slideInFromRight 0.5s ease-out;
      }

      /* Mobile responsiveness for toast */
      @media (max-width: 768px) {
        .submission-status-update {
          top: 10px;
          left: 10px;
          right: 10px;
          max-width: calc(100% - 20px);
        }
      }

      .submission-status-update .alert {
        padding: 20px;
        border-radius: 8px;
        border: 1px solid #d4edda;
        background-color: #d1ecf1;
        color: #155724;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
        position: relative;
      }

      /* Toast type variations */
      .submission-status-update .alert-success {
        border-color: #d4edda;
        background-color: #d1ecf1;
        color: #155724;
      }

      .submission-status-update .alert-error {
        border-color: #f5c6cb;
        background-color: #f8d7da;
        color: #721c24;
      }

      .submission-status-update .alert-warning {
        border-color: #ffeaa7;
        background-color: #fff3cd;
        color: #856404;
      }

      .submission-status-update .alert-info {
        border-color: #b3d7ff;
        background-color: #d1ecf1;
        color: #0c5460;
      }

      .submission-status-update h4 {
        margin-bottom: 10px;
        color: #27ae60;
        padding-right: 30px; /* Space for close button */
      }

      /* Toast title colors by type */
      .submission-status-update .alert-success h4 {
        color: #27ae60;
      }

      .submission-status-update .alert-error h4 {
        color: #dc3545;
      }

      .submission-status-update .alert-warning h4 {
        color: #fd7e14;
      }

      .submission-status-update .alert-info h4 {
        color: #17a2b8;
      }

      .submission-status-update p {
        margin: 5px 0;
      }

      .toast-close {
        position: absolute;
        top: 10px;
        right: 15px;
        background: none;
        border: none;
        font-size: 20px;
        color: #666;
        cursor: pointer;
        line-height: 1;
        padding: 0;
        width: 20px;
        height: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .toast-close:hover {
        color: #333;
        background-color: rgba(0, 0, 0, 0.1);
        border-radius: 50%;
      }

      @keyframes slideInFromRight {
        from {
          opacity: 0;
          transform: translateX(100%);
        }
        to {
          opacity: 1;
          transform: translateX(0);
        }
      }

      @keyframes slideOutToRight {
        from {
          opacity: 1;
          transform: translateX(0);
        }
        to {
          opacity: 0;
          transform: translateX(100%);
        }
      }
    </style>
  </head>
  <body>
    <!-- Login Screen -->
    <div
      id="loginScreen"
      class="login-container"
    >
      <h2 style="text-align: center; margin-bottom: 30px">Contest Management Platform</h2>
      <div
        id="loginError"
        class="alert alert-error hidden"
      ></div>
      <div class="form-group">
        <label for="username">Username:</label>
        <input
          type="text"
          id="username"
          placeholder="Enter username"
        />
      </div>
      <div class="form-group">
        <label for="password">Password:</label>
        <input
          type="password"
          id="password"
          placeholder="Enter password"
        />
      </div>
      <button
        class="btn btn-success"
        onclick="login()"
        style="width: 100%"
      >
        Login
      </button>
      <div style="margin-top: 15px; font-size: 14px; color: #666">
        <strong>Demo Credentials:</strong><br />
        Host: host/host123<br />
        Judges: judge1/judge123, judge2/judge123<br />
        Teams: team1/team123, team2/team123, team3/team123
      </div>
    </div>

    <!-- Main Application -->
    <div
      id="mainApp"
      class="container hidden"
    >
      <div class="header">
        <h1>Contest Management Platform</h1>
        <p>Manage contests, submissions, and evaluations</p>
        <div
          id="userInfo"
          class="user-info hidden"
        >
          <div>
            <span id="userName"></span>
            <span
              id="userRole"
              class="role-badge"
            ></span>
          </div>
          <button
            class="btn btn-danger"
            onclick="logout()"
          >
            Logout
          </button>
        </div>
      </div>

      <!-- Navigation -->
      <div
        id="navigation"
        class="nav"
      >
        <!-- Navigation buttons will be populated based on user role -->
      </div>

      <!-- Content Sections -->
      <div class="content">
        <div id="alertContainer"></div>

        <!-- Host Sections -->
        <div
          id="hostProblems"
          class="section"
        >
          <h2>Problem Management</h2>
          <button
            class="btn btn-success"
            onclick="showCreateProblem()"
          >
            Create New Problem
          </button>
          <div id="problemsList"></div>
        </div>

        <div
          id="createProblem"
          class="section"
        >
          <h2>Create New Problem</h2>
          <div class="card">
            <form id="createProblemForm">
              <div class="grid">
                <div>
                  <div class="form-group">
                    <label for="problemId">Problem ID:</label>
                    <input
                      type="text"
                      id="problemId"
                      required
                      placeholder="unique-problem-id"
                    />
                  </div>
                  <div class="form-group">
                    <label for="problemTitle">Title:</label>
                    <input
                      type="text"
                      id="problemTitle"
                      required
                      placeholder="Problem Title"
                    />
                  </div>
                  <div class="form-group">
                    <label for="problemDescription">Description:</label>
                    <textarea
                      id="problemDescription"
                      rows="4"
                      placeholder="Problem description..."
                    ></textarea>
                  </div>
                  <div class="form-group">
                    <label for="problemDomain">Domain:</label>
                    <input
                      type="text"
                      id="problemDomain"
                      placeholder="e.g., Databases, ML, Systems"
                    />
                  </div>
                </div>
                <div>
                  <div class="form-group">
                    <label for="submissionDockerImage">Submission Docker Image:</label>
                    <input
                      type="text"
                      id="submissionDockerImage"
                      required
                      placeholder="gcr.io/project/image:tag"
                    />
                  </div>
                  <div class="form-group">
                    <label for="submissionDockerParams">Submission Docker Parameters:</label>
                    <textarea
                      id="submissionDockerParams"
                      rows="3"
                      placeholder="Docker run parameters (JSON format)"
                    ></textarea>
                  </div>
                  <div class="form-group">
                    <label for="baselineDockerImage">Baseline Docker Image (Optional):</label>
                    <input
                      type="text"
                      id="baselineDockerImage"
                      placeholder="gcr.io/project/baseline:tag"
                    />
                  </div>
                  <div class="form-group">
                    <label for="baselineDockerParams">Baseline Docker Parameters:</label>
                    <textarea
                      id="baselineDockerParams"
                      rows="3"
                      placeholder="Docker run parameters (JSON format)"
                    ></textarea>
                  </div>
                </div>
              </div>
              <button
                type="submit"
                class="btn btn-success"
              >
                Create Problem
              </button>
              <button
                type="button"
                class="btn"
                onclick="showSection('hostProblems')"
              >
                Cancel
              </button>
            </form>
          </div>
        </div>

        <!-- Judge Sections -->
        <div
          id="judgeSubmissions"
          class="section"
        >
          <h2>All Submissions</h2>
          <div id="submissionsTable"></div>
        </div>

        <div
          id="judgeEvaluate"
          class="section"
        >
          <h2>Evaluate Submission</h2>
          <div id="evaluationForm"></div>
        </div>

        <div
          id="judgeFiles"
          class="section"
        >
          <h2>Submission Files</h2>
          <div id="fileBrowser"></div>
        </div>

        <!-- Team Sections -->
        <div
          id="teamSubmit"
          class="section"
        >
          <h2>Submit Solution</h2>
          <div id="teamSubmissionForm"></div>
        </div>

        <div
          id="teamStatus"
          class="section"
        >
          <h2>My Submissions</h2>
          <div id="teamSubmissions"></div>
        </div>

        <!-- Shared Sections -->
        <div
          id="leaderboard"
          class="section"
        >
          <h2>Leaderboard</h2>
          <div id="leaderboardTable"></div>
        </div>

        <div
          id="problems"
          class="section"
        >
          <h2>Problems</h2>
          <div id="problemsTable"></div>
        </div>
      </div>
    </div>

    <!-- Confirmation Dialog -->
    <div
      id="confirmationDialog"
      class="confirmation-dialog hidden"
    >
      <div class="dialog-content">
        <h3 id="confirmTitle">Confirm Action</h3>
        <p id="confirmMessage">Are you sure?</p>
        <div style="margin-top: 20px; text-align: right">
          <button
            class="btn"
            onclick="hideConfirmation()"
          >
            Cancel
          </button>
          <button
            class="btn btn-danger"
            id="confirmButton"
            onclick="confirmAction()"
          >
            Confirm
          </button>
        </div>
      </div>
    </div>

    <!-- Auto-refresh Controls -->
    <div class="auto-refresh-controls">
      <button
        id="autoRefreshToggle"
        class="btn btn-warning"
        onclick="toggleAutoRefresh()"
      >
        Disable Auto-refresh
      </button>
    </div>

    <script src="app.js"></script>
  </body>
</html>
